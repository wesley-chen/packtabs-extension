# Project Structure

## Directory Organization

```
packtabs-extension/
├── entrypoints/          # Extension entry points (WXT convention)
│   ├── background.ts     # Background service worker
│   └── dashboard/        # Dashboard HTML page
│       ├── index.html
│       ├── main.ts
│       ├── App.vue
│       └── style.css
├── components/           # Reusable Vue components
├── stores/               # Pinia state management stores
├── types/                # TypeScript type definitions
│   ├── TabGroup.ts       # Core domain types
│   └── Storage.ts        # Storage schema and WXT storage items
├── utils/                # Utility functions and services
│   ├── storage.ts        # Storage service layer
│   └── init-app.ts       # App initialization logic
├── tests/                # Test files
│   ├── setup.ts          # Vitest global setup
│   ├── unit/             # Unit tests (mirror source structure)
│   └── property/         # Property-based tests
├── public/               # Static assets
│   └── icon/             # Extension icons (16, 32, 48, 96, 128)
├── assets/               # Build-time assets
└── .wxt/                 # WXT generated files (gitignored)
```

## Key Conventions

### Auto-imports

- WXT auto-imports all APIs and exports from `components/`, `composables/`, `hooks/`, `utils/`
- No need to import `defineBackground`, `storage`, `browser`, or utility functions
- TypeScript support via `.wxt/types/imports-module.d.ts` (generated by `bun run postinstall`)
- Use explicit `#imports` module if you prefer explicit imports

### Entrypoints

- WXT uses `entrypoints/` for extension pages (background, popup, content scripts, HTML pages)
- Each HTML page gets its own folder (e.g., `dashboard/`)
- Entrypoints can be single file or directory with `index` file
- Must be 0 or 1 level deep (no deeply nested entrypoints)
- Background script uses `defineBackground(() => { ... })` from WXT
- Content scripts use `defineContentScript({ matches: [...], main() { ... } })`
- **CRITICAL**: All runtime code must be inside main function for JS/TS entrypoints
- Code outside main function runs during build in NodeJS environment

### Entrypoint Naming Patterns

- Background: `background.ts` or `background/index.ts`
- Content scripts: `content.ts`, `{name}.content.ts`, or `{name}.content/index.ts`
- HTML pages: `popup.html`, `options.html`, `dashboard.html`, etc.
- Unlisted pages: `{name}.html` → accessible at `/{name}.html`
- Unlisted scripts: `{name}.ts` → accessible at `/{name}.js`
- Unlisted CSS: `{name}.css` → must be manually imported

### Types

- Domain types in `types/TabGroup.ts` (TabItem, TabGroup interfaces)
- Storage schema in `types/Storage.ts` with WXT storage item definitions
- Use `storage.defineItem<T>()` for type-safe storage access

### Storage Layer

- `utils/storage.ts` provides service functions (saveTabGroup, getTabGroups, etc.)
- Serialize/deserialize functions handle Date ↔ ISO string conversion
- All storage operations are async and use WXT storage API

### Components

- Vue 3 Composition API with `<script setup>` syntax
- PrimeVue components imported as needed
- Use `@/` alias for absolute imports from project root

### Testing

- Unit tests in `tests/unit/` mirror source file structure
- Property-based tests in `tests/property/` use fast-check
- Setup file at `tests/setup.ts` for global test configuration
- Clear storage with `await tabGroupsStorage.setValue({})` in beforeEach
- WXT auto-imports work in tests via `WxtVitest()` plugin
- No need to mock `browser` APIs - fake implementation provided automatically
- To mock WXT APIs, use real paths from `.wxt/types/imports-module.d.ts`

### State Management

- Pinia stores in `stores/` directory
- Use `useTabStore` pattern for store naming
- Share state across extension pages via Pinia

## File Naming

- Vue components: PascalCase (e.g., `TabGroupCard.vue`)
- TypeScript files: camelCase (e.g., `storage.ts`, `useTabStore.ts`)
- Type files: PascalCase (e.g., `TabGroup.ts`, `Storage.ts`)
- Test files: Match source name with `.test.ts` suffix
